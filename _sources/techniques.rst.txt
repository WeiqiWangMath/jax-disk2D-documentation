Techniques
==========

This page discusses the various techniques we explored during the development of this PINN framework.

Sampling Strategies
-------------------

We tested planet-focused and spiral arm sampling strategies, which were designed based on empirical fitting to the solution, to concentrate collocation points in regions of interest, such as near the planet location and along the spiral density wave structures. However, these adaptive sampling methods showed no significant improvement in the final accuracy compared to uniform random sampling. Therefore, we kept uniform random sampling in polar coordinates over the domain :math:`[r_{\text{min}}, r_{\text{max}}] \times [-\pi, \pi] \times [t_{\text{min}}, t_{\text{max}}]` as the default approach due to its simplicity and comparable performance. Other potential sampling strategies, such as spatiotemporal adaptive sampling and wave front sampling, were not tested.

Frame Angular Velocity
----------------------

The frame angular velocity :math:`\Omega_{\text{frame}}` used in the rotating reference frame is derived from Kepler's third law. For a corotating frame with the planet, the angular velocity is :math:`\Omega_{\text{frame}} = \sqrt{G(M_* + m_p)/r_p^3} = \sqrt{1 + 10^{-5}} \approx 1.000005` in FARGO3D units, where :math:`M_*` is the stellar mass, :math:`m_p` is the planet mass, and :math:`r_p` is the planet orbital radius. This formulation correctly accounts for the gravitational influence of both the star and the planet, ensuring consistency between the PINN governing equations and the FARGO3D reference simulations.

Time-Stepping-Oriented Neural Network (TSONN)
----------------------------------------------

We considered the Time-Stepping-Oriented Neural Network (TSONN) approach proposed by `Cao and Zhang (2023) <https://arxiv.org/abs/2310.16491>`_, which integrates time-stepping methods with deep learning to transform the ill-conditioned optimization problem into a series of well-conditioned sub-problems over pseudo time intervals. While this method shows promise for improving training stability in time-dependent PDEs, our initial consideration raised the question: if we are incorporating time-stepping methods into the neural network framework, why not directly use traditional numerical methods? Nevertheless, TSONN represents a potentially feasible approach to make PINNs work more effectively for time-dependent problems, and it could be worth exploring in future work for challenging scenarios where standard PINNs struggle with training convergence.

Enforcing Periodic Boundary Conditions
---------------------------------------

We tested the method proposed by `Dong and Ni (2021) <https://doi.org/10.1016/j.jcp.2021.110242>`_ for exactly enforcing periodic boundary conditions with deep neural networks. This method represents a different approach compared to our standard implementation of periodic boundary conditions. It constructs specialized periodic layers that automatically satisfy periodicity requirements for the function and its derivatives to machine precision. We suspected that our construction for imposing periodic boundary conditions might cause some issues in the training process, and we explored this alternative method to see if it could address potential problems. However, in our implementation and testing, this approach did not improve the performance of our PINN solver for the disk hydrodynamics problem. We ultimately found that our standard methods for handling periodic boundary conditions were sufficient for our application.

Time-Marching Error Accumulation
---------------------------------

We examined the error accumulation behavior of the time-marching strategy as a function of time for different numbers of time folds. Our analysis shows that the error increases approximately linearly during the first few orbital periods, then reaches a plateau and remains relatively flat for the remainder of the simulation. This behavior is consistent across different time-marching configurations, with similar error evolution patterns observed for both 16 and 32 time folds. This suggests that the error accumulation in the time-marching approach is not strongly sensitive to the number of folds once a sufficient number is used, and that the dominant error contribution occurs during the initial propagation phase.

Radial Boundary Conditions
---------------------------

An important finding in our work concerns the treatment of radial boundary conditions. In our initial implementation, we imposed boundary conditions at the inner and outer radial boundaries to match the FARGO reference simulations. However, through careful analysis of the PINN solution, we observed that while the solution evolved correctly during the first few orbital periods, the density waves generated by the planet stopped propagating away from the planet location after approximately 4-5 orbits. This premature cessation of wave propagation was inconsistent with the expected physical behavior. After removing the radial boundary conditions and allowing the PINN to solve the governing equations without explicit boundary constraints at :math:`r_{\text{min}}` and :math:`r_{\text{max}}`, the waves were able to propagate correctly and reach the domain boundaries as expected. This finding suggests that for this particular problem, the boundary conditions may have been over-constraining the solution and preventing the PINN from capturing the correct wave dynamics.

Equation Form Reformulation
---------------------------

Some research has shown that changing the form of governing equations can provide advantages in PINN training. For example, `Kharazmi et al. (2021) <https://doi.org/10.1016/j.cma.2020.113547>`_ demonstrated that using variational formulations and integration by parts can reduce the order of differential operators and improve training efficiency, particularly for problems with rough solutions or singularities. We considered exploring different equation formulations for our disk hydrodynamics problem. However, the governing equations (continuity, momentum, and energy equations in rotating coordinates) are already quite complex, involving multiple nonlinear terms and coupling between variables. Reformulating these equations would make verification of correctness challenging, and without clear evidence about which direction would be beneficial for our specific problem, we decided not to pursue this path. We retained the standard strong-form PDEs in our implementation.

Numerical Precision
-------------------

Many research studies indicate that double precision (64-bit) can largely improve the accuracy of PINNs, particularly for problems requiring high-order derivative computations. However, in our case, while 64-bit precision does provide some improvement over 32-bit precision, the enhancement is only limited. As shown in the test results comparing 32-bit and 64-bit precision (see :doc:`test_results`), the accuracy gains are modest and come at the cost of significantly longer training times and increased memory usage. We therefore use 32-bit precision as the default configuration, which provides a good balance between computational efficiency and solution accuracy for this disk hydrodynamics application.

Memory Considerations
---------------------

When running ``pinn:train``, users should be aware that the test function called at the end of training is memory-intensive. This function loads the full test dataset and generates predictions on the entire spatiotemporal grid, which requires substantial memory allocation. Although the current version includes optimizations to reduce memory usage, the operation still requires considerable memory resources. We recommend using at least 64GB of RAM when running training jobs to avoid out-of-memory errors, especially for large-scale simulations with fine spatial and temporal resolution.
